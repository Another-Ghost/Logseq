alias:: 并发

- # 定义
	- *计算机* 的[[并发]]，指在单个系统里**同时**执行多个独立的任务。
	- ## 任务切换
		- 具有单个处理单元或核芯的处理器只能在某一时刻执行一个任务，不过可以在单位时间内对任务进行多次切换，因为任务切换得太快，以至于无法感觉到任务会暂时挂起。这种被称为[[任务切换]]，是[[并发]]的一种。
	- ## 硬件并发
		- 多核处理器能够真正的[[并行]]多个任务，我们称其为[[硬件并发]]。
	- 有些处理器可以在一个核心上执行多个[[线程]]，但[[硬件并发]]在 多处理器 上效果更加显著。
	  硬件线程最重要的是**数量**，也就是可以并发运行独立任务的数量。即便是硬件并发的系统，也有比硬件 可并行最大任务数 还要多的任务需要执行，所以任务切换在这些情况下仍然适用。
	  ![四个任务在两个核心之间的切换.png](../assets/image_1699887981532_0.png)
	- 如何使用并发，很大程度上取决于可用的硬件并发。
- # 并发的方式
	- ## 多进程并发
		- [[多进程并发]]是将[[应用程序]]分为多个独立的[[进程]]同时运行。
		- 如图所示，独立的进程可以通过 *进程间的通信渠道* 传递讯息([[信号]]、[[套接字]]、[[文件]]、[[管道]]等等)。
		  ![一对并发运行的进程之间的通信.png](../assets/image_1699888608777_0.png)
		- ### 缺点
			- 这种 进程间的通信 通常非常复杂，或是速度很慢。这是因为[[操作系统]]会对进程进行保护，以避免一个进程去修改另一个进程的数据。
			- 运行多个进程会有固定**开销**：需要时间启动进程，操作系统需要资源来管理进程等等。
		- ### 优点
			- 操作系统在进程间提供了 保护 和 更高级别的通信机制，可以更容易编写安全的并发代码。
			- 可以使用[[远程连接]](可能需要联网)的方式，在不同的机器上运行独立的进程。
	- ## 多线程并发
		- [[多线程并发]]是指在单[[进程]]中运行多个[[线程]]。
		- [[线程]]很像轻量级的[[进程]]：每个线程相互独立运行，并且可以在不同的[[指令序列]]中运行。
		- 不过，进程中的所有线程都[[共享地址空间]]，并且能访问到大部分数据——[[全局变量]]仍然是全局的，指向对象或数据的[[指针]]或[[引用]]可以在线程之间传递。
		  下图展示了一个进程中的两个线程，正在通过[[共享内存]]进行通信。
		  ![image.png](../assets/image_1699889907028_0.png)
		- ## 优点
			- [[地址空间共享]]，以及缺少线程间的 *数据保护* ，使得操作系统记录的工作量减小，所以使用多线程的开销**远远小于**多进程。
		- ## 缺点
			- 共享内存的灵活性是有代价的：如果多个线程访问数据，那么必须确保每个线程所访问到的数据一致，这就需要对[[线程通信]]做大量的工作。
	- 多个 单线程/进程间的通信 ，要比单一进程中 多线程通信 的开销大，若不考虑共享内存可能带来的问题，多线程将会成为主流语言更青睐的并发方式。
	  此外，[[C++]]标准并未对进程通信提供原生支持，所以实现会依赖于平台相关的API。
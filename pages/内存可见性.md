alias:: 可见, 可见性

- 内存可见性是多线程编程中的一个关键概念，指在一个线程中对共享变量所做的修改能够被其他线程观察到的性质。具体来说，当一个线程修改了一个共享变量，这个修改对于其他访问该变量的线程应当是可见的，这样**其他线程才能看到最新的值**。
- ### 重要性
  内存可见性问题主要出现在具有多个处理器和多级缓存系统的计算机架构中。在这种环境下，每个处理器可能有自己的缓存，它们可能会缓存共享变量的不同副本。如果这些缓存之间不正确地同步，就会导致内存可见性问题，即一个线程对共享变量所做的更改对其他线程不可见。
- ### 问题产生
  1. **处理器缓存**：现代多核CPU有各自的缓存，线程对共享变量的读写操作可能仅在本地缓存中进行，而不是在主内存中。
  2. **编译器优化**：为了提高性能，编译器可能会重新排序指令或优化存储，这可能影响线程间变量的可见性。
- ### 解决方法
  
  1. **锁和同步**：使用锁（如`mutex`）可以确保内存可见性，因为锁的获取和释放通常涉及内存屏障（memory barrier），它们会强制将缓存中的数据写回到主内存并使缓存失效。
  2. **原子操作**：原子操作确保对变量的修改是不可分割的，使用原子变量（如`std::atomic`）还可以通过内存顺序参数来明确内存可见性要求。
  3. **内存栅栏**：内存栅栏是一种同步机制，用来防止指令重排，确保特定操作的执行顺序，从而保证内存操作的可见性。
- ### 举例
  在C++中，如果一个线程写入`std::atomic`变量，然后另一个线程读取该变量，读操作能够保证看到写操作的结果，前提是适当的内存顺序参数被用于这些操作。
- ### 总结
  内存可见性确保了在多线程环境中，一个线程对共享数据的更改可以被其他线程正确地观察到。缺乏适当的同步机制会导致内存可见性问题，可能会使程序行为异常或不确定。因此，在设计和实现多线程程序时，正确处理内存可见性至关重要。